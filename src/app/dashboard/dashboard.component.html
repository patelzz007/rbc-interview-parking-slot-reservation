<div class="container">
  <div class="flex flex-row justify-between items-center mb-4">
    <h1 class="m-0 p-0">Parking Lot Reservations</h1>

    <button
      (click)="openCreate()"
      type="button"
      class="rounded-md! bg-indigo-600! px-3.5 py-2.5 text-sm font-semibold text-white shadow-xs hover:bg-indigo-500"
    >
      Create
    </button>
  </div>

  @if (reservations$ | async; as data) {
    <!-- load reference data once -->
    @if (parkingLots$ | async; as lots) {
      @if (users$ | async; as users) {
        <table mat-table [dataSource]="data" class="mat-elevation-z8">
          <!-- ID -->
          <ng-container matColumnDef="id">
            <th mat-header-cell *matHeaderCellDef>ID</th>
            <td mat-cell *matCellDef="let r">{{ r.id.slice(0, 8) }}...</td>
          </ng-container>

          <!-- User -->
          <ng-container matColumnDef="userName">
            <th mat-header-cell *matHeaderCellDef>User Name</th>
            <td mat-cell *matCellDef="let r">
              {{ getUserName(r.userId, users) }}
            </td>
          </ng-container>

          <!-- Lot -->
          <ng-container matColumnDef="lotName">
            <th mat-header-cell *matHeaderCellDef>Lot Name</th>
            <td mat-cell *matCellDef="let r">
              {{ getLotName(r.lotId, lots) }}
            </td>
          </ng-container>

          <!-- Space -->
          <ng-container matColumnDef="spaceNumber">
            <th mat-header-cell *matHeaderCellDef>Space</th>
            <td mat-cell *matCellDef="let r">
              {{ r.spaceId }}
            </td>
          </ng-container>

          <!-- Check In -->
          <ng-container matColumnDef="checkInDateTime">
            <th mat-header-cell *matHeaderCellDef>Check In</th>
            <td mat-cell *matCellDef="let r">
              {{ r.checkInDateTime | date: 'short' }}
            </td>
          </ng-container>

          <!-- Check Out -->
          <ng-container matColumnDef="checkOutDateTime">
            <th mat-header-cell *matHeaderCellDef>Check Out</th>
            <td mat-cell *matCellDef="let r">
              {{ r.checkOutDateTime | date: 'short' }}
            </td>
          </ng-container>

          <!-- Status -->
          <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef>Status</th>
            <td mat-cell *matCellDef="let r">
              {{ r.status }}
            </td>
          </ng-container>

          <!-- Actions -->
          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef>Actions</th>
            <td mat-cell *matCellDef="let r">
              <button mat-button [matMenuTriggerFor]="menu">Actions</button>
              <mat-menu #menu="matMenu">
                <button mat-menu-item (click)="openEdit(r)">Edit</button>
                <button mat-menu-item (click)="deleteReservation(r.id)">Delete</button>
              </mat-menu>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
        </table>
      }
    }
  } @else {
    <p>Loading reservations...</p>
  }
</div>
