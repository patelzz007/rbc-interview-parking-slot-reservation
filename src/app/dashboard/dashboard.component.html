<div class="container">
  <div class="flex flex-row justify-between items-center mb-4">
    <h1 class="m-0 p-0">Parking Lot Reservations</h1>
    <button
      (click)="openCreate()"
      type="button"
      class="rounded-md! bg-indigo-600! px-3.5 py-2.5 text-sm font-semibold text-white shadow-xs hover:bg-indigo-500 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 dark:bg-indigo-500 dark:shadow-none dark:hover:bg-indigo-400 dark:focus-visible:outline-indigo-500"
    >
      Create
    </button>
  </div>

  @if (reservations(); as data) {
    <table mat-table [dataSource]="data" class="mat-elevation-z8">
      <!-- ID Column -->
      <ng-container matColumnDef="id">
        <th mat-header-cell *matHeaderCellDef>ID</th>
        <td mat-cell *matCellDef="let reservation">{{ reservation.id.slice(0, 8) }}...</td>
      </ng-container>

      <!-- User Name Column -->
      <ng-container matColumnDef="userName">
        <th mat-header-cell *matHeaderCellDef>User Name</th>
        <td mat-cell *matCellDef="let reservation">
          {{ getUserName(reservation.userId) }}
        </td>
      </ng-container>

      <!-- Lot Name Column -->
      <ng-container matColumnDef="lotName">
        <th mat-header-cell *matHeaderCellDef>Lot Name</th>
        <td mat-cell *matCellDef="let reservation">
          {{ getLotName(reservation.lotId) }}
        </td>
      </ng-container>

      <!-- Space Number Column -->
      <ng-container matColumnDef="spaceNumber">
        <th mat-header-cell *matHeaderCellDef>Space</th>
        <td mat-cell *matCellDef="let reservation">
          {{ getSpaceNumber(reservation.spaceId) }}
        </td>
      </ng-container>

      <!-- Check In Column -->
      <ng-container matColumnDef="checkInDateTime">
        <th mat-header-cell *matHeaderCellDef>Check In</th>
        <td mat-cell *matCellDef="let reservation">
          {{ reservation.checkInDateTime | date: 'short' }}
        </td>
      </ng-container>

      <!-- Check Out Column -->
      <ng-container matColumnDef="checkOutDateTime">
        <th mat-header-cell *matHeaderCellDef>Check Out</th>
        <td mat-cell *matCellDef="let reservation">
          {{ reservation.checkOutDateTime | date: 'short' }}
        </td>
      </ng-container>

      <!-- Status Column -->
      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef>Status</th>
        <td mat-cell *matCellDef="let reservation">{{ reservation.status }}</td>
      </ng-container>

      <!-- Actions Column -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Actions</th>
        <td mat-cell *matCellDef="let reservation">
          <button mat-button [matMenuTriggerFor]="menu">Actions</button>
          <mat-menu #menu="matMenu">
            <button mat-menu-item>Edit</button>
            <button mat-menu-item (click)="deleteReservation()">Delete</button>
          </mat-menu>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>
  } @else {
    <p>Loading reservations...</p>
  }
</div>
